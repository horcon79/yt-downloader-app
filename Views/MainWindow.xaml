<Window x:Class="YoutubeDownloader.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="clr-namespace:YoutubeDownloader.ViewModels"
        mc:Ignorable="d"
        Title="Horcon - Youtube Downloader v.1.0" 
        Height="750" 
        Width="700"
        ResizeMode="CanResize"
        WindowStartupLocation="CenterScreen"
        Icon="pack://application:,,,/download.png">
    

    <Window.Resources>
        <Style TargetType="Button">
            <Setter Property="Padding" Value="10,5"/>
            <Setter Property="Margin" Value="5"/>
        </Style>
        <Style TargetType="TextBox">
            <Setter Property="Padding" Value="5"/>
            <Setter Property="Margin" Value="5"/>
        </Style>
        <Style TargetType="Label">
            <Setter Property="Margin" Value="5,2,5,2"/>
        </Style>
        <Style TargetType="ComboBox">
            <Setter Property="Padding" Value="5"/>
            <Setter Property="Margin" Value="5"/>
        </Style>
    </Window.Resources>

    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Tytul -->
        <TextBlock Grid.Row="0" 
                   Text="YouTube Downloader" 
                   FontSize="24" 
                   FontWeight="Bold" 
                   HorizontalAlignment="Center" 
                   Margin="0,10"/>

        <!-- URL -->
        <GroupBox Grid.Row="1" Header="URL filmu" Margin="0,5">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <TextBox Grid.Column="0" 
                         Text="{Binding Url, UpdateSourceTrigger=PropertyChanged}"
                         ToolTip="Wklej URL filmu YouTube lub Shorts"
                         IsEnabled="{Binding IsDownloading, Converter={StaticResource InverseBoolConverter}}"/>
                <Button Grid.Column="1" 
                        Content="Wklej" 
                        Command="ApplicationCommands.Paste"
                        IsEnabled="{Binding IsDownloading, Converter={StaticResource InverseBoolConverter}}"/>
            </Grid>
        </GroupBox>

        <!-- Format -->
        <GroupBox Grid.Row="2" Header="Format" Margin="0,5">
            <StackPanel Orientation="Horizontal" Margin="5">
                <RadioButton Content="MP4" 
                             IsChecked="{Binding SelectedFormat, Converter={StaticResource EnumToBoolConverter}, ConverterParameter=Mp4}"
                             Margin="10,0"
                             IsEnabled="{Binding IsDownloading, Converter={StaticResource InverseBoolConverter}}"/>
                <RadioButton Content="MKV" 
                             IsChecked="{Binding SelectedFormat, Converter={StaticResource EnumToBoolConverter}, ConverterParameter=MkV}"
                             Margin="10,0"
                             IsEnabled="{Binding IsDownloading, Converter={StaticResource InverseBoolConverter}}"/>
                <RadioButton Content="WebM" 
                             IsChecked="{Binding SelectedFormat, Converter={StaticResource EnumToBoolConverter}, ConverterParameter=WebM}"
                             Margin="10,0"
                             IsEnabled="{Binding IsDownloading, Converter={StaticResource InverseBoolConverter}}"/>
                <Separator Style="{StaticResource {x:Static ToolBar.SeparatorStyleKey}}" Margin="10,0"/>
                <RadioButton Content="MP3 (audio)" 
                             IsChecked="{Binding SelectedFormat, Converter={StaticResource EnumToBoolConverter}, ConverterParameter=Mp3}"
                             Margin="10,0"
                             IsEnabled="{Binding IsDownloading, Converter={StaticResource InverseBoolConverter}}"/>
                <RadioButton Content="M4A (audio)" 
                             IsChecked="{Binding SelectedFormat, Converter={StaticResource EnumToBoolConverter}, ConverterParameter=M4A}"
                             Margin="10,0"
                             IsEnabled="{Binding IsDownloading, Converter={StaticResource InverseBoolConverter}}"/>
                
                <Separator Style="{StaticResource {x:Static ToolBar.SeparatorStyleKey}}" Margin="10,0"/>
                
                <Button Content="Historia" 
                        Command="{Binding ShowHistoryCommand}"
                        Padding="10,2"
                        Background="#FFF0F0F0"
                        BorderBrush="#FFCCCCCC"
                        VerticalAlignment="Center">
                    <Button.Style>
                        <Style TargetType="Button">
                            <Style.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Background" Value="#FFE0E0E0"/>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </Button.Style>
                </Button>
            </StackPanel>
        </GroupBox>

        <!-- Ustawienia jakosci -->
        <GroupBox Grid.Row="3" Header="Ustawienia jakosci" Margin="0,5">
            <StackPanel Margin="5">
                <!-- Tryb transkodowania (tylko dla wideo) -->
                <StackPanel Visibility="{Binding IsAudioOnly, Converter={StaticResource BoolToVisibilityConverter}, ConverterParameter=Reverse}">
                    <RadioButton Content="A) Bez transkodowania (najszybciej)" 
                                 IsChecked="{Binding EncodingMode, Converter={StaticResource EnumToBoolConverter}, ConverterParameter=NoTranscoding}"
                                 Margin="5,2"
                                 IsEnabled="{Binding IsDownloading, Converter={StaticResource InverseBoolConverter}}"/>
                    <RadioButton Content="B) Transkoduj (FFmpeg) i ustaw bitrate" 
                                 IsChecked="{Binding EncodingMode, Converter={StaticResource EnumToBoolConverter}, ConverterParameter=Transcode}"
                                 Margin="5,2"
                                 IsEnabled="{Binding IsDownloading, Converter={StaticResource InverseBoolConverter}}"/>
                    
                    <!-- Opcje transkodowania -->
                    <StackPanel Margin="20,5,5,5" Visibility="{Binding EncodingMode, Converter={StaticResource EnumToVisibilityConverter}, ConverterParameter=Transcode}">
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,5">
                            <Label Content="Bitrate wideo:" Margin="0" VerticalAlignment="Center"/>
                            <ComboBox ItemsSource="{Binding VideoBitratePresets}"
                                      SelectedItem="{Binding SelectedVideoBitratePreset}"
                                      DisplayMemberPath="Name"
                                      Width="200"
                                      Margin="5,0"
                                      IsEnabled="{Binding IsDownloading, Converter={StaticResource InverseBoolConverter}}"/>
                        </StackPanel>
                        
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,5" 
                                    Visibility="{Binding IsCustomVideoBitrateVisible, Converter={StaticResource BoolToVisibilityConverter}}">
                            <Label Content="Wpisz bitrate (kbps):" VerticalAlignment="Center"/>
                            <TextBox Text="{Binding VideoBitrate, UpdateSourceTrigger=PropertyChanged}"
                                     Width="80"
                                     Margin="5,0"
                                     IsEnabled="{Binding IsDownloading, Converter={StaticResource InverseBoolConverter}}"/>
                        </StackPanel>
                    </StackPanel>
                </StackPanel>

                <!-- Bitrate audio -->
                <StackPanel Orientation="Horizontal" Margin="5">
                    <Label Content="Bitrate audio:"/>
                    <ComboBox ItemsSource="{Binding AudioBitrateValues}" 
                              SelectedValue="{Binding AudioBitrate}"
                              Width="100"
                              IsEnabled="{Binding IsDownloading, Converter={StaticResource InverseBoolConverter}}"/>
                </StackPanel>
            </StackPanel>
        </GroupBox>

        <!-- Folder zapisu -->
        <GroupBox Grid.Row="4" Header="Folder zapisu" Margin="0,5">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <TextBox Grid.Column="0" 
                         Text="{Binding OutputFolder}"
                         IsReadOnly="True"
                         ToolTip="{Binding OutputFolder}"/>
                <Button Grid.Column="1" 
                        Content="Wybierz..." 
                        Command="{Binding SelectFolderCommand}"
                        IsEnabled="{Binding IsDownloading, Converter={StaticResource InverseBoolConverter}}"/>
            </Grid>
        </GroupBox>

        <!-- Postep -->
        <GroupBox Grid.Row="5" Header="Postep" Margin="0,5">
            <StackPanel Margin="5">
                <ProgressBar Minimum="0" Maximum="100" 
                             Value="{Binding Progress}" 
                             Height="25"
                             Margin="5"/>
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <TextBlock Grid.Column="0" 
                               Text="{Binding ProgressText}" 
                               HorizontalAlignment="Center"
                               VerticalAlignment="Center"
                               FontSize="14"
                               FontWeight="Bold"/>
                    <TextBlock Grid.Column="1" 
                               Text="{Binding Speed}" 
                               Margin="10,0"
                               VerticalAlignment="Center"/>
                    <TextBlock Grid.Column="2" 
                               Text="{Binding Eta}" 
                               Margin="10,0"
                               VerticalAlignment="Center"/>
                </Grid>
                <TextBlock Text="{Binding StatusMessage}" 
                           HorizontalAlignment="Center"
                           Foreground="Blue"
                           Margin="5"/>
            </StackPanel>
        </GroupBox>

        <!-- Przyciski -->
        <StackPanel Grid.Row="6" Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,10">
            <Button Content="Pobierz" 
                    Command="{Binding DownloadCommand}"
                    Width="120"
                    Height="35"
                    FontWeight="Bold"
                    Background="{Binding IsDownloading, Converter={StaticResource BoolToGrayConverter}}"/>
            <Button Content="Anuluj" 
                    Command="{Binding CancelCommand}"
                    Width="120"
                    Height="35"
                    Background="LightSalmon"
                    IsEnabled="{Binding IsDownloading}"/>
            <Button Content="Otworz folder" 
                    Command="{Binding OpenFolderCommand}"
                    Width="120"
                    IsEnabled="{Binding OutputFolder, Converter={StaticResource StringToBoolConverter}}"/>
        </StackPanel>

        <!-- Status narzedzi -->
        <Border Grid.Row="7" BorderBrush="LightGray" BorderThickness="1" Margin="0,5" Padding="5">
            <StackPanel>
                <TextBlock Text="Dostepnosc narzedzi:" FontWeight="Bold"/>
                <TextBlock Foreground="{Binding ToolAvailability.YtdlpAvailable, Converter={StaticResource BoolToGreenConverter}}">
                    <TextBlock.Style>
                        <Style TargetType="TextBlock">
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding ToolAvailability.YtdlpAvailable}" Value="True">
                                    <Setter Property="Text" Value="yt-dlp: Dostepny"/>
                                </DataTrigger>
                                <DataTrigger Binding="{Binding ToolAvailability.YtdlpAvailable}" Value="False">
                                    <Setter Property="Text" Value="yt-dlp: Brak (pobieranie nie bedzie dzialac)"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </TextBlock.Style>
                </TextBlock>
                <TextBlock Foreground="{Binding ToolAvailability.FfmpegAvailable, Converter={StaticResource BoolToGreenConverter}}">
                    <TextBlock.Style>
                        <Style TargetType="TextBlock">
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding ToolAvailability.FfmpegAvailable}" Value="True">
                                    <Setter Property="Text" Value="ffmpeg: Dostepny"/>
                                </DataTrigger>
                                <DataTrigger Binding="{Binding ToolAvailability.FfmpegAvailable}" Value="False">
                                    <Setter Property="Text" Value="ffmpeg: Brak (transkodowanie wylaczone)"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </TextBlock.Style>
                </TextBlock>
                <TextBlock Text="NarzÄ™dzia powinny znajdowac sie w katalogu 'tools/' obok pliku EXE." 
                           FontSize="10" 
                           Foreground="Gray"
                           Margin="0,5"/>
            </StackPanel>
        </Border>

        <!-- Log -->
        <GroupBox Grid.Row="8" Header="Log" Margin="0,5" Height="200">
            <Grid>
                <TextBox x:Name="LogTextBox"
                         IsReadOnly="True" 
                         Text="{Binding LogMessages}"
                         VerticalScrollBarVisibility="Auto"
                         FontFamily="Consolas"
                         FontSize="10"
                         TextChanged="LogTextBox_TextChanged"/>
                <Button Content="X" 
                        HorizontalAlignment="Right" 
                        VerticalAlignment="Top"
                        Width="25" 
                        Height="25"
                        Margin="5"
                        Command="{Binding ClearLogCommand}"/>
            </Grid>
        </GroupBox>

    </Grid>
</Window>
