<Window x:Class="YoutubeDownloader.Views.BatchDownloadWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="clr-namespace:YoutubeDownloader.ViewModels"
        mc:Ignorable="d"
        Title="{DynamicResource BatchWindowTitle}"
        Height="800"
        Width="900"
        ResizeMode="CanResize"
        WindowStartupLocation="CenterOwner"
        Icon="pack://application:,,,/download.png">

    <Window.Resources>
        <Style TargetType="Button">
            <Setter Property="Padding" Value="10,5"/>
            <Setter Property="Margin" Value="5"/>
        </Style>
        <Style TargetType="TextBox">
            <Setter Property="Padding" Value="5"/>
            <Setter Property="Margin" Value="5"/>
        </Style>
        <Style TargetType="Label">
            <Setter Property="Margin" Value="5,2,5,2"/>
        </Style>
        <Style TargetType="ComboBox">
            <Setter Property="Padding" Value="5"/>
            <Setter Property="Margin" Value="5"/>
        </Style>
        <Style TargetType="CheckBox">
            <Setter Property="Margin" Value="5"/>
        </Style>
    </Window.Resources>

    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Tytuł -->
        <TextBlock Grid.Row="0" 
                   Text="{DynamicResource BatchWindowTitle}" 
                   FontSize="20" 
                   FontWeight="Bold" 
                   HorizontalAlignment="Center" 
                   Margin="0,5"/>

        <!-- Panel importu -->
        <GroupBox Grid.Row="1" Header="{DynamicResource BatchImportGroupHeader}" Margin="0,5">
            <StackPanel Orientation="Horizontal" Margin="5">
                <Button Content="{DynamicResource BatchImportFromFile}" 
                        Command="{Binding ImportFromFileCommand}"
                        Width="150"/>
                <Button Content="{DynamicResource BatchAddUrl}" 
                        Command="{Binding AddUrlCommand}"
                        Width="150"/>
                <Separator Style="{StaticResource {x:Static ToolBar.SeparatorStyleKey}}" Margin="10,0"/>
                <Button Content="{DynamicResource BatchSelectAll}" 
                        Command="{Binding SelectAllCommand}"
                        Width="80"/>
                <Button Content="{DynamicResource BatchDeselectAll}" 
                        Command="{Binding DeselectAllCommand}"
                        Width="80"/>
            </StackPanel>
        </GroupBox>

        <!-- Ustawienia globalne -->
        <GroupBox Grid.Row="2" Header="{DynamicResource BatchSettingsGroupHeader}" Margin="0,5">
            <Grid Margin="5">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="120"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="100"/>
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Folder -->
                <Label Grid.Column="0" Grid.Row="0" Content="{DynamicResource OutputFolderGroupBoxHeader}"/>
                <TextBox Grid.Column="1" Grid.Row="0" 
                         Text="{Binding Settings.OutputFolder}" 
                         IsReadOnly="True"
                         ToolTip="{Binding Settings.OutputFolder}"/>
                <Button Grid.Column="2" Grid.Row="0" 
                        Content="{DynamicResource SelectButton}" 
                        Command="{Binding SelectFolderCommand}"
                        Padding="10,2"/>

                <!-- Format i równoległość -->
                <Label Grid.Column="3" Grid.Row="0" Content="{DynamicResource FormatGroupBoxHeader}"/>
                <ComboBox Grid.Column="4" Grid.Row="0" 
                          ItemsSource="{Binding AvailableFormats}"
                          SelectedItem="{Binding Settings.DefaultFormat}"
                          Width="100"/>
                <Label Grid.Column="5" Grid.Row="0" Content="{DynamicResource BatchParallelLabel}"/>
                
                <!-- Audio i transkodowanie -->
                <Label Grid.Column="0" Grid.Row="1" Content="{DynamicResource AudioBitrateLabel}"/>
                <ComboBox Grid.Column="1" Grid.Row="1" 
                          ItemsSource="{Binding AvailableAudioBitrates}"
                          SelectedValue="{Binding Settings.DefaultAudioBitrate}"
                          Width="100"/>

                <CheckBox Grid.Column="2" Grid.Row="1" 
                          Content="{DynamicResource BatchSkipExisting}"
                          IsChecked="{Binding Settings.SkipExistingFiles}"/>
                <CheckBox Grid.Column="3" Grid.Row="1" 
                          Content="{DynamicResource BatchAutoStart}"
                          IsChecked="{Binding Settings.AutoStartOnLoad}"/>
            </Grid>
        </GroupBox>

        <!-- Lista pobierania -->
        <GroupBox Grid.Row="3" Header="{DynamicResource BatchQueueGroupHeader}" Margin="0,5">
            <Grid>
                <DataGrid ItemsSource="{Binding Items}" 
                          SelectedItem="{Binding SelectedItem}"
                          AutoGenerateColumns="False"
                          CanUserAddRows="False"
                          CanUserDeleteRows="False"
                          IsReadOnly="True"
                          SelectionMode="Single">
                    <DataGrid.Columns>
                        <DataGridTemplateColumn Width="30">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <CheckBox IsChecked="{Binding IsSelected}" 
                                              VerticalAlignment="Center"
                                              HorizontalAlignment="Center"/>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>
                        <DataGridTextColumn Header="{DynamicResource BatchColumnStatus}" 
                                            Width="80"
                                            Binding="{Binding State}">
                            <DataGridTextColumn.CellStyle>
                                <Style TargetType="DataGridCell">
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding State}" Value="Completed">
                                            <Setter Property="Foreground" Value="Green"/>
                                        </DataTrigger>
                                        <DataTrigger Binding="{Binding State}" Value="Error">
                                            <Setter Property="Foreground" Value="Red"/>
                                        </DataTrigger>
                                        <DataTrigger Binding="{Binding State}" Value="Downloading">
                                            <Setter Property="Foreground" Value="Blue"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </DataGridTextColumn.CellStyle>
                        </DataGridTextColumn>
                        <DataGridTextColumn Header="{DynamicResource BatchColumnProgress}" 
                                            Width="80"
                                            Binding="{Binding Progress, StringFormat={}{0:F1}%}"/>
                        <DataGridTextColumn Header="{DynamicResource BatchColumnUrl}" 
                                            Width="*"
                                            Binding="{Binding Url}">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="TextTrimming" Value="CharacterEllipsis"/>
                                    <Setter Property="ToolTip" Value="{Binding Url}"/>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>
                        <DataGridTextColumn Header="{DynamicResource BatchColumnFormat}" 
                                            Width="60"
                                            Binding="{Binding Format}"/>
                        <DataGridTextColumn Header="{DynamicResource BatchColumnSpeed}" 
                                            Width="80"
                                            Binding="{Binding Speed}"/>
                    </DataGrid.Columns>
                </DataGrid>
            </Grid>
        </GroupBox>

        <!-- Postęp ogólny -->
        <GroupBox Grid.Row="4" Header="{DynamicResource BatchOverallProgressHeader}" Margin="0,5">
            <StackPanel Margin="5">
                <ProgressBar Minimum="0" Maximum="100" 
                             Value="{Binding OverallProgress}" 
                             Height="25"
                             Margin="5"/>
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <TextBlock Grid.Column="0" 
                               Text="{Binding OverallProgressText}" 
                               HorizontalAlignment="Center"
                               VerticalAlignment="Center"
                               FontSize="14"
                               FontWeight="Bold"/>
                    <TextBlock Grid.Column="1" 
                               Text="{Binding StatusMessage}" 
                               Margin="10,0"
                               VerticalAlignment="Center"/>
                </Grid>
            </StackPanel>
        </GroupBox>

        <!-- Przyciski kontroli -->
        <StackPanel Grid.Row="5" Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,10">
            <Button Content="{DynamicResource BatchStartAll}" 
                    Command="{Binding StartCommand}"
                    Width="120"
                    Height="35"
                    FontWeight="Bold"
                    Background="{Binding IsDownloading, Converter={StaticResource BoolToGrayConverter}}"/>
            <Button Content="{DynamicResource BatchPause}" 
                    Command="{Binding PauseCommand}"
                    Width="100"
                    Height="35"
                    Background="LightYellow"
                    IsEnabled="{Binding IsDownloading}"/>
            <Button Content="{DynamicResource CancelButton}" 
                    Command="{Binding CancelCommand}"
                    Width="100"
                    Height="35"
                    Background="LightSalmon"
                    IsEnabled="{Binding IsDownloading}"/>
            <Button Content="{DynamicResource BatchRetryFailed}" 
                    Command="{Binding RetryFailedCommand}"
                    Width="120"
                    Height="35"
                    IsEnabled="{Binding HasFailedItems}"/>
            <Button Content="{DynamicResource BatchRemoveCompleted}" 
                    Command="{Binding RemoveCompletedCommand}"
                    Width="150"
                    Height="35"
                    Background="#FFF0F0F0"
                    BorderBrush="#FFCCCCCC"/>
            <Separator Style="{StaticResource {x:Static ToolBar.SeparatorStyleKey}}" Margin="10,0"/>
            <Button Content="{DynamicResource OpenFolderButton}" 
                    Command="{Binding OpenFolderCommand}"
                    Width="120"
                    Height="35"/>
            <Button Content="{DynamicResource CloseButton}" 
                    Click="CloseButton_Click"
                    Width="100"
                    Height="35"/>
        </StackPanel>

        <!-- Log -->
        <GroupBox Grid.Row="5" Header="{DynamicResource LogGroupBoxHeader}" Margin="0,5" Height="150" Visibility="Collapsed">
            <Grid>
                <TextBox IsReadOnly="True" 
                         Text="{Binding LogMessages}"
                         VerticalScrollBarVisibility="Auto"
                         FontFamily="Consolas"
                         FontSize="10"/>
            </Grid>
        </GroupBox>

    </Grid>
</Window>
